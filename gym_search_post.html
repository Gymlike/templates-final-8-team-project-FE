<!DOCTYPE html>
<html lang="en">

<head>
  <script type="text/javascript"
    src="//dapi.kakao.com/v2/maps/sdk.js?appkey=7b74dc0c556886b85431732b36435069&libraries=services"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
    crossorigin="anonymous"></script>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="author" content="Untree.co" />
  <link rel="shortcut icon" href="favicon.png" />

  <meta name="description" content="" />
  <meta name="keywords" content="bootstrap, bootstrap5" />

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="fonts/icomoon/style.css" />
  <link rel="stylesheet" href="fonts/flaticon/font/flaticon.css" />
  <link rel="stylesheet" href="css/tiny-slider.css" />
  <link rel="stylesheet" href="css/aos.css" />
  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="css/kakamap.css" />

  <title>
    운동시설 사이트
  </title>
</head>

<body>
  <div class="site-mobile-menu site-navbar-target">
    <div class="site-mobile-menu-header">
      <div class="site-mobile-menu-close">
        <span class="icofont-close js-menu-toggle"></span>
      </div>
    </div>
    <div class="site-mobile-menu-body"></div>
  </div>

  <nav class="site-nav">
    <div>
      <ul><a style="color:white"><span id="loginUser"></span></a>
        <a style="color:white" href="login.html"><span id="MainLogin">로그인</span></a>
        <a style="color:white" href="login.html"><span id="MainSignUp">회원가입</span></a>
        <a style="color:white" href="mypage.html"><span id="mypage">마이페이지</span></a>
        <a style="color:white" href="FIndByIdAndPw.html"><span id="findIdAndPW">Id/Password찾기</span></a>
        <a style="color:white" onclick="logout()" href="index.html">
          <span id="MainLogout">로그아웃</span>
      </ul>
    </div>
    <div class="container">
      <div class="menu-bg-wrap">
        <div class="site-navigation">
          <a href="index.html" class="logo m-0 float-start">SearchingGYM</a>

          <ul class="js-clone-nav d-none d-lg-inline-block text-start site-menu float-end">
            <li class="active"><a href="gym_write_post.html">운동시설등록</a></li>
            <li class="has-children">
              <a href="T_exe.html">게시판</a>
              <ul class="dropdown">
                <li><a href="">자유게시판</a></li>
                <li><a href="T_exe.html">오운완게시판</a></li>
                <li><a href="">오먹게시판</a></li>
              </ul>
            </li>
            <li class="has-children">
              <a href="services.html">이벤트게시판</a>
              <ul class="dropdown">
                <li><a href="#">유저이벤트</a></li>
                <li><a href="#">헬스장이벤트</a></li>
                <li><a href="#">사이트이벤트</a></li>
              </ul>
            </li>
            <li class="has-children">
              <a href="contactIndex.html">고객센터</a>
              <ul class="dropdown">
                <li><a href="#">공지사항</a></li>
                <li><a href="#">FAQ</a></li>
                <li><a href="contactPageIndex-inquiry.html">1:1문의</a></li>
              </ul>
            </li>
 
            <li><a href="gym_all_show_post.html">운동시설</a></li>
            
          </ul>
          
          <a
          href="#"
          class="burger light me-auto float-end mt-1 site-menu-toggle js-menu-toggle d-inline-block d-lg-none"
          data-toggle="collapse"
          data-target="#main-navbar"
        > 
          <span></span>
        </a>
        </div>
      </div>
    </div>
  </nav>
  <div class="hero">
    <div class="hero-slide">
      <div class="img overlay" style="background-image: url('images/hero_bg_3.jpg')"></div>
      <div class="img overlay" style="background-image: url('images/hero_bg_2.jpg')"></div>
      <div class="img overlay" style="background-image: url('images/hero_bg_1.jpg')"></div>
    </div>


    <div class="container">
      <div class="row justify-content-center align-items-center">
        <div class="col-lg-9 text-center mt-5">
          <h1 class="heading" data-aos="fade-up">등록된 운동시설 목록</h1>

          <nav aria-label="breadcrumb" data-aos="fade-up" data-aos-delay="200">
            <ol class="breadcrumb text-center justify-content-center">
              <li class="breadcrumb-item"><a href="index.html">Home으로 이동</a></li>
            </ol>
          </nav>
        </div>
      </div>
    </div>
  </div>

  <!------------------- 운동시설 보여주는 자리 시작-------------------->
  
  
  <div class="section section-properties">
    <input id="gymSearchInput" type="text" onkeyup="enterkey()" placeholder="제목 검색" 
    style="text-align:center;flex:1;border:1;width: 90%;">
  <button class="btn btn-primary py-2 px-3" id="gymSearchPost" onclick="gymSearching()" type="button">검색</button>
    <div class="container">


        <div class="text-center">
            <div class="row" id="gym_search_post_box"> 
  
            </div> 
      </div>
      
      <div class="col-lg-3"></div>
      <div class="col-lg-6 text-center">
        <div class="custom-pagination" id="gymPaging">

        </div>
      </div>
      <div class="row align-items-center py-5">
        <div class="col-lg-3"></div>
      </div>
    </div>
  </div>

  <!------------------- 운동시설 보여주는 자리 끝-------------------->
  <!-- <script src="js/jquery-3.3.1.min.js"></script>
  <script src="js/jquery-ui.js"></script> -->
  <script src="js/bootstrap.bundle.min.js"></script>
  <script src="js/tiny-slider.js"></script>
  <script src="js/aos.js"></script>
  <script src="js/navbar.js"></script>
  <script src="js/counter.js"></script>
  <script src="js/custom.js"></script>
  <script src="js/kakaomap.js"></script>
  <script src="js/gymshowall.js"></script>

</body>
<script>
  $(document).ready(function () { 
    var keywords = localStorage.getItem('searching')
    if (keywords === null) {
      keywords = ""
    }
    var para = document
      .location
      .href
      .split("?");
    console.log(para[1])

    console.log("키워드값" + keywords)

    var settings = {
      "url": "http://localhost:8080/api/gym?page=" + para[1] + "&search=" + keywords,
      "method": "GET",
      "timeout": 0,
    };

    $.ajax(settings).done(function (response) {
        
        $('#gym_search_post_box').empty()
        $('#gymPaging').empty()
        console.log(response); 
        let gymReponse = response.data
        for (let i = 0; i < gymReponse.length;  i++) {
            let gymIid = gymReponse[i]['id']
            let title = gymReponse[i]['title']
            let content = gymReponse[i]['content']
            let gymName = gymReponse[i]['gymName']
            let location = gymReponse[i]['location']
            let time = gymReponse[i]['createdDate']
            let image = gymReponse[i]['image'] 
            let rating = gymReponse[i]['rating'] 
            
        switch(rating){
                  case 0: 
                  temp_html = ` 
                            <div class="col-xs-12 col-sm-6 col-md-6 col-lg-4"> 
                                <div class="property-item  mb-30">
                                    <a href="gym_show_post.html?${gymIid}" class="img">
                                      <img src="${image}" alt="Image" class="img-fluid" />
                                    </a>

                                    <div class="property-content">
                                      <div class="price mb-2"><span>"리뷰가 없어요 최초로 작성해보세요"</span></div>
                                      <div> 
                                        <span class="city d-block mb-3">글 제목 : ${title}</span>


                                        <div class="specs d-flex mb-4">
                                          <span class="d-block d-flex align-items-center me-3"> 
                                            <span class="caption">지역 : ${location}</span>
                                          </span> 
                                        </div>

                                        <div class="specs d-flex mb-4"> 
                                          <span class="d-block d-flex align-items-center"> 
                                            <span class="caption">시설이름 : ${gymName}</span>
                                          </span>
                                        </div> 
                                        
                                        <a   href="gym_show_post.html?${gymIid}"
                                          class="btn btn-primary py-2 px-3"
                                          >상세 내용</a>
                                      </div>
                                    </div>
                                </div> 
                            </div>
                        `
                    break;
                  default: 

                  temp_html = `
                            <div class="col-xs-12 col-sm-6 col-md-6 col-lg-4">
                                <div class="property-item mb-30">
                                    <a href="gym_show_post.html?${gymIid}" class="img">
                                      <img src="${image}" alt="Image" class="img-fluid" />
                                    </a>

                                    <div class="property-content">
                                      <div class="price mb-2"><span> [평점   ${rating}]</span></div>
                                      <div> 
                                        <span class="city d-block mb-3">글 제목 : ${title}</span>

                                        <div class="specs d-flex mb-4">
                                          <span class="d-block d-flex align-items-center me-3"> 
                                            <span class="caption">지역 : ${location}</span>
                                          </span> 
                                        </div>

                                        <div class="specs d-flex mb-4"> 
                                          <span class="d-block d-flex align-items-center"> 
                                            <span class="caption">시설이름 : ${gymName}</span>
                                          </span>
                                        </div>
                                        <a   href="gym_show_post.html?${gymIid}"
                                          class="btn btn-primary py-2 px-3"
                                          >상세 내용</a>
                                      </div>
                                    </div>
                                </div> 
                            </div>
                        `
              }
              $('#gym_search_post_box').append(temp_html) 
      } 
      if(page != 0){
        var keywords = localStorage.removeItem('searching')
        let page = response.page
        let totalCount = response.totalCount
        let countPage = response.countPage
        let startPage = ((page - 1) / 10) * 10 + 1;
        let endPage = startPage + countPage - 1;
        let totalPage = response.totalPage; 
        if (totalPage < page) {
          page = totalPage;
        }
        if (endPage > totalPage) {
          endPage = totalPage
        }
  
        var param = document.location.href.split("?");
          console.log("현재페이지 : " + param[1])
          //이전페이지
          if (page > 1) {
              let temp_html = `<a href="gym_search_post.html?${page - 1}">pre</a>`
              $('#gymPaging').append(temp_html);
          }
          //한 화면에 보여지는 페이지 수만큼 반복 하여 번호로 나타냄
          for (let i = startPage; i <= endPage; i++) {
              let number = i
              let temp_html = `<a href="gym_search_post.html?${number}">${number}</a>`
              $('#gymPaging').append(temp_html);
          }
          //다음페이지 page
          if (page < totalPage) {
              let temp_html = `<a href="gym_search_post.html?${page + 1}">next</a>`
              $('#gymPaging').append(temp_html);
          } 
      }else{
        let temp_html = `<h2>찾으시는 내용이 없습니다.</h2>`
        $('#gymPaging').append(temp_html);
      }
    });
  })

  document.getElementById("mypage").style.display = "none";
  document.getElementById("MainLogout").style.display = "none";
  document.getElementById("adminpage").style.display = "none";
  function enterkey() {
        if (window.event.keyCode == 13) { 
             // 엔터키가 눌렸을 때 실행할 내용
             gymSearching();
        }
  } 
  
function gymSearching() {

  var keywords = $('#gymSearchInput').val();

  localStorage.setItem('searching', keywords)

  console.log(keywords)
  window.location = '/gym_search_post.html?1'

}
</script>

</html>