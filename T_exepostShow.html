<!-- /*
* Template Name: Property
* Template Author: Untree.co
* Template URI: https://untree.co/
* License: https://creativecommons.org/licenses/by/3.0/
*/ -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="Untree.co" />
    <link rel="shortcut icon" href="favicon.png" />

    <meta name="description" content="" />
    <meta name="keywords" content="bootstrap, bootstrap5" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="fonts/icomoon/style.css" />
    <link rel="stylesheet" href="fonts/flaticon/font/flaticon.css" />

    <link rel="stylesheet" href="css/tiny-slider.css" />
    <link rel="stylesheet" href="css/aos.css" />
    <link rel="stylesheet" href="css/style.css" />

    <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>

    <title>
      Property &mdash; Free Bootstrap 5 Website Template by Untree.co
    </title>
  </head>
  <body>
    <div class="site-mobile-menu site-navbar-target">
      <div class="site-mobile-menu-header">
        <div class="site-mobile-menu-close">
          <span class="icofont-close js-menu-toggle"></span>
        </div>
      </div>
      <div class="site-mobile-menu-body"></div>
    </div>

    <nav class="site-nav">
      <div class="container">
        <div class="menu-bg-wrap">
          <div class="site-navigation">
            <a href="index.html" class="logo m-0 float-start">Property</a>

            <ul
              class="js-clone-nav d-none d-lg-inline-block text-start site-menu float-end"
            >
              <li><a href="index.html">Home</a></li>
              <li class="has-children">
                <a href="properties.html">Properties</a>
                <ul class="dropdown">
                  <li><a href="#">Buy Property</a></li>
                  <li><a href="#">Sell Property</a></li>
                  <li class="has-children">
                    <a href="#">Dropdown</a>
                    <ul class="dropdown">
                      <li><a href="#">Sub Menu One</a></li>
                      <li><a href="#">Sub Menu Two</a></li>
                      <li><a href="#">Sub Menu Three</a></li>
                    </ul>
                  </li>
                </ul>
              </li>
              <li><a href="services.html">Services</a></li>
              <li><a href="about.html">About</a></li>
              <li class="active"><a href="contact.html">Contact Us</a></li>
            </ul>

            
              <span></span>
            </a>
          </div>
        </div>
      </div>
    </nav>

    <div
      class="hero page-inner overlay"
      style="background-image: url('images/T_exe.jpg')"
    >
      <div class="container">
        <div class="row justify-content-center align-items-center">
          <div class="col-lg-9 text-center mt-5">
            <h1 class="heading" data-aos="fade-up">
              오늘 운동 완료
            </h1>

           
          </div>
        </div>
      </div>
    </div>

    <div class="section">
      <div class="container" id="t_exePosting">


      </div>
    </div>

    <div class="site-footer">
      <div class="container">
        <div class="row">
          <div class="col-lg-4">
            <div class="widget">
              <h3>Contact</h3>
              <address>43 Raymouth Rd. Baltemoer, London 3910</address>
              <ul class="list-unstyled links">
                <li><a href="tel://11234567890">+1(123)-456-7890</a></li>
                <li><a href="tel://11234567890">+1(123)-456-7890</a></li>
                <li>
                  <a href="mailto:info@mydomain.com">info@mydomain.com</a>
                </li>
              </ul>
            </div>
            <!-- /.widget -->
          </div>
          <!-- /.col-lg-4 -->
          <div class="col-lg-4">
            <div class="widget">
              <h3>Sources</h3>
              <ul class="list-unstyled float-start links">
                <li><a href="#">About us</a></li>
                <li><a href="#">Services</a></li>
                <li><a href="#">Vision</a></li>
                <li><a href="#">Mission</a></li>
                <li><a href="#">Terms</a></li>
                <li><a href="#">Privacy</a></li>
              </ul>
              <ul class="list-unstyled float-start links">
                <li><a href="#">Partners</a></li>
                <li><a href="#">Business</a></li>
                <li><a href="#">Careers</a></li>
                <li><a href="#">Blog</a></li>
                <li><a href="#">FAQ</a></li>
                <li><a href="#">Creative</a></li>
              </ul>
            </div>
            <!-- /.widget -->
          </div>
          <!-- /.col-lg-4 -->
          <div class="col-lg-4">
            <div class="widget">
              <h3>Links</h3>
              <ul class="list-unstyled links">
                <li><a href="#">Our Vision</a></li>
                <li><a href="#">About us</a></li>
                <li><a href="#">Contact us</a></li>
              </ul>

              <ul class="list-unstyled social">
                <li>
                  <a href="#"><span class="icon-instagram"></span></a>
                </li>
                <li>
                  <a href="#"><span class="icon-twitter"></span></a>
                </li>
                <li>
                  <a href="#"><span class="icon-facebook"></span></a>
                </li>
                <li>
                  <a href="#"><span class="icon-linkedin"></span></a>
                </li>
                <li>
                  <a href="#"><span class="icon-pinterest"></span></a>
                </li>
                <li>
                  <a href="#"><span class="icon-dribbble"></span></a>
                </li>
              </ul>
            </div>
            <!-- /.widget -->
          </div>
          <!-- /.col-lg-4 -->
        </div>
        <!-- /.row -->

        <div class="row mt-5">
          <div class="col-12 text-center">
            <!-- 
              **==========
              NOTE: 
              Please don't remove this copyright link unless you buy the license here https://untree.co/license/  
              **==========
            -->

            <p>
              Copyright &copy;
              <script>
                document.write(new Date().getFullYear());
              </script>
              . All Rights Reserved. &mdash; Designed with love by
              <a href="https://untree.co">Untree.co</a>
              <!-- License information: https://untree.co/license/ -->
            </p>
            <div>
              Distributed by
              <a href="https://themewagon.com/" target="_blank">themewagon</a>
            </div>
          </div>
        </div>
      </div>
      <!-- /.container -->
    </div>
    <!-- /.site-footer -->

    <!-- Preloader -->
    <div id="overlayer"></div>
    <div class="loader">
      <div class="spinner-border" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>

    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/tiny-slider.js"></script>
    <script src="js/aos.js"></script>
    <script src="js/navbar.js"></script>
    <script src="js/counter.js"></script>
    <script src="js/custom.js"></script>
  
  <script>



// -----------------------------[로드시 실행]-------------------------------------------------
$(document).ready(function(){
  var para = document.location.href.split("?");
      console.log(para[1])
// ----------------------------------[ajax get 시작]--------------------------------------------
var settings = {
  "url": "http://localhost:8080/t-exercise/selectboard/"+para[1],
  "method": "GET",
  "timeout": 0, 
};

$.ajax(settings).done(function (response) {

  console.log(response);

let tilte = response['title']
let content = response['content']
let modifiedDate = response['modifiedDate']
let like = response['like']
let postid = response['id']
let nickname = response['userNickname']

// -----------------------------[게시글보여주기]-------------------------------------------------
var temp = `<div class="row justify-content-between">
          <div class="col-lg-7">
            <div class="img-property-slide-wrap">
              <div class="img-property-slide">
                <img src="images/img_1.jpg" alt="Image" class="img-fluid" />
              </div>
            </div>
          
          </div>
          <div class="col-lg-4">
            <h2 class="heading text-primary">${tilte}</h2>
            <p class="meta">${modifiedDate} 
            <button name="editpost">수정</button>
            <button name="delpost">삭제</button>
            </p>
            <p class="text-black-50">
              ${content} 
            </p> 
            <p class="meta">작성자 : ${nickname}</p>
            <section class="mb-5">
                        <div class="card bg-light">
                            <div class="card-body"  id = "comment">
                                <!-- Comment form-->
                                <form class="mb-4"><textarea id ="commentEnroll"class="form-control" rows="3" placeholder="댓글을 남겨주세요"></textarea> <button type="button" name='enrollComment'>댓글등록</button></form>
                                
                      
                                <!-- Comment with nested comments-->
                                
                                
                                <!-- Single comment-->
                            
                            </div>
                        </div>
                    </section>
          </div>
        </div>`

$('#t_exePosting').append(temp)
// ------------------------------------------------------------------------------

// -----------------------------[댓글보여주기 실행]-------------------------------------------------
let commentList =response['commentList']

 for(let i=0;i<commentList.length;i++){
        var userNickname = commentList[i]['nickname']  
        var commentContent = commentList[i]['content']
        var createdDate =commentList[i]['creatDate']
        var commentId = commentList[i]['id']
        console.log(userNickname +" 닉네임이군")

    
         var comment =`<div class="d-flex">                       
                   <div class="ms-3">
                   <div class="fw-bold">${userNickname}</div>
                   <div class="text-black-50">${commentContent}</div> 
                   <p class="text-black-50">${createdDate}

                    <button name="creatRe" id="reply_${commentId}" >답글</button>
                    <button name="editComment" id ="edit_${commentId}">수정</button>
                    <button name="delComment" id ="comment_${commentId}">삭제</button>
                    
                    
                    <span style="display: none;" id="toggleEdit_${commentId}">
                      <textarea id="editCommentContent_${commentId}"></textarea> 
                      <button name="saveEdit" id="commentEdit_${commentId}">댓글수정</button>
                       </span>

                    <span style="display: none;" id="toggleRe_${commentId}">
                      <textarea id="replyCommentContent_${commentId}"></textarea> 
                      <button name="saveRe" id="commentSave_${commentId}">답글작성</button>
                       </span>
                       <div class="d-flex mt-4">
                        <div class="ms-3" id='commentReply_${commentId}'>
                                               
                                        </div>
                                        
                    </p>
                    
                   </div>
           </div>`
           $('#comment').append(comment)
        
// ------------------------------[대댓글보여주기 ]-----------------------------------------------------

           let commentReplylist =commentList[i]['commentReplyList'] 
             console.log(commentReplylist) 

      for(let j=0;j<commentReplylist.length;j++){
           var userNickname = commentReplylist[j]['writerName']
           var commentReplyContent = commentReplylist[j]['content']
           var replyCreatDate = commentReplylist[j]['creatDate']
           var commentReplyId = commentReplylist[j]['id']
           var commentReply =`<div class="fw-bold">${userNickname}</div>
                          <div class="text-black-50">${commentReplyContent}</div> 
                          <div class="text-black-50" style="margin-bottom:5px;">${replyCreatDate}

                          
                          <button name="editCommentReply" id ="editReply_${commentReplyId}">수정</button>
                          <button name="delCommentReply" id ="commentReply_${commentReplyId}">삭제</button>


                          <span style="display: none;" id="toggleEditReply_${commentReplyId}">
                          <textarea id="editCommentReplyContent_${commentReplyId}"></textarea> 
                          <button name="saveEditReply" id="commentReplyEdit_${commentReplyId}">댓글수정</button>
                          </span>
                          
                          </div>
                          </div>
                                                `
                                   
                 $('#commentReply_'+commentId).append(commentReply)
          }

// ------------------------------대댓글보여주기끝-----------------------------------------------------      
   }
// ----------------------------------댓글보여주기 끝--------------------------------------------
});
// ----------------------------------ajax get 끝--------------------------------------------
});

// ----------------------------------로드시 실행되는부분 끝-------------------------------------------


// ----------------------------------[해당버튼 클릭시 댓글쓰기]-----------------------------------------------------


$('#t_exePosting').on("click", "button[name='enrollComment']", function(){
  var para = document.location.href.split("?");
      console.log(para[1])

  var settings = {
  "url": "http://localhost:8080/t-exercise/"+para[1]+"/comment",
  "method": "POST",
  "timeout": 0,
  "headers": {
    "Authorization":localStorage.getItem('accessToken'),
    "Content-Type": "application/json"
  },
 
  "data": JSON.stringify({
    "comment": $('#commentEnroll').val()
  }),
};

$.ajax(settings).done(function (response) {
  console.log(response);
  alert(response)
  window.location.reload()
});
}
)
// ------------------------------------------------------------------------------------------------


// ------------------------[해당버튼 클릭시 게시글 수정 페이지 이동]------------------------
$('#t_exePosting').on("click", "button[name='editpost']", function(){
  var para = document.location.href.split("?");
      console.log(para[1])

    window.location ="./T_exepostEdit.html?"+para[1]
    
  
})
// ------------------------------------------------------------------------------------------------




// --------------------[해당 버튼 클릭시 게시글 삭제]---------------------

$('#t_exePosting').on("click", "button[name='delpost']", function(){
  var para = document.location.href.split("?");
      console.log(para[1])

      var settings = {
  "url": "http://localhost:8080/t-exercise/"+para[1],
  "method": "DELETE",
  "timeout": 0,
  "headers": {
    "Authorization": localStorage.getItem('accessToken')
  },
};

$.ajax(settings).done(function (response) {
  console.log(response);
  alert(response)
  window.location='./T_exe.html'
}).fail(function(response){
   console.log(response.responseJSON);
   if(response.responseJSON.statusCode === 403){
    alert(response.responseJSON.message)
   }

});
  
  
})
// ------------------------------------------------




// -----[해당 버튼 클릭시 댓글삭제]-----------

$('#t_exePosting').on("click", "button[name='delComment']", function(){
  var para = document.location.href.split("?");
      console.log(para[1])

      var id_by_name = $(this).attr('id')

      console.log(id_by_name)
      var commentId = id_by_name.split("_")[1]
      console.log(commentId)
      var settings = {
  "url": "http://localhost:8080/t-exercise/"+para[1]+"/comment/"+commentId,
  "method": "DELETE",
  "timeout": 0,
  "headers": {
    "Authorization": localStorage.getItem('accessToken')
  },
};

$.ajax(settings).done(function (response) {
  console.log(response);
  alert(response)
   window.location.reload();

}).fail(function(response){
   console.log(response.responseJSON);
   if(response.responseJSON.statusCode === 403){
    alert(response.responseJSON.message)
   }
});
})
// ------------------------------------------------



// -----[해당 버튼 클릭시 댓글수정 창 나옴]-------------------

$('#t_exePosting').on("click", "button[name='editComment']", function(){

var id_by_name = $(this).attr('id')
var commentId =id_by_name.split("_")[1]
console.log(commentId)

$("#toggleEdit_"+commentId).toggle();

})
// ---------------------------------------------------------



// -----[해당 버튼 클릭시 댓글수정 요청]----------------------
$('#t_exePosting').on("click", "button[name='saveEdit']", function(){
  

  var id_by_name = $(this).attr('id')

  var commentId = id_by_name.split("_")[1]
  console.log(commentId)
  var settings = {
"url": "http://localhost:8080/t-exercise/-1/comment/"+commentId,
"method": "PUT",
"timeout": 0,
"headers": {
"Authorization": localStorage.getItem('accessToken'),
"Content-Type": "application/json"
},
"data": JSON.stringify({
"comment": $('#editCommentContent_'+commentId).val()
}),
};

$.ajax(settings).done(function (response) {
console.log(response);
alert(response)
window.location.reload();
}).fail(function(response){
console.log(response.responseJSON);
if(response.responseJSON.statusCode === 403){
alert(response.responseJSON.message)
window.location.reload();
}
if(response.responseJSON.statusCode === 404){
  alert("다른 유저의 댓글은 수정할 수 없습니다.")
  window.location.reload();
}
});
})
// ---------------------------------------------------------






// -----[해당 버튼 클릭시 답글적는창 나옴]-------------------

$('#t_exePosting').on("click", "button[name='creatRe']", function(){

      var id_by_name = $(this).attr('id')
      var commentId =id_by_name.split("_")[1]
      console.log(commentId)

      $("#toggleRe_"+commentId).toggle();

})
// ---------------------------------------------------------





// -----[해당 버튼 클릭시 답글DB로 보냄]-------------------
$('#t_exePosting').on("click", "button[name='saveRe']", function(){
  

      var id_by_name = $(this).attr('id')
    
      var commentId = id_by_name.split("_")[1]
      console.log(commentId)
      var settings = {
  "url": "http://localhost:8080/t-exercise/comment/"+commentId,
  "method": "POST",
  "timeout": 0,
  "headers": {
    "Authorization": localStorage.getItem('accessToken'),
    "Content-Type": "application/json"
  },
  "data": JSON.stringify({
    "comment": $('#replyCommentContent_'+commentId).val()
  }),
};

$.ajax(settings).done(function (response) {
  console.log(response);
  alert(response)
  window.location.reload();
}).fail(function(response){
   console.log(response.responseJSON);
   if(response.responseJSON.statusCode === 403){
    alert(response.responseJSON.message)
   }
});
})
// ---------------------------------------------------------




// -----[해당 버튼 클릭시 답글 수정 창 나옴]-------------------

$('#t_exePosting').on("click", "button[name='editCommentReply']", function(){

var id_by_name = $(this).attr('id')
var commentId =id_by_name.split("_")[1]
console.log(commentId)

$("#toggleEditReply_"+commentId).toggle();

})
// ---------------------------------------------------------



// -----[해당 버튼 클릭시 대댓글수정 요청]----------------------
$('#t_exePosting').on("click", "button[name='saveEditReply']", function(){
  

  var id_by_name = $(this).attr('id')

  var commentId = id_by_name.split("_")[1]
  console.log(commentId)
  var settings = {
"url": "http://localhost:8080/t-exercise/comment/"+commentId,
"method": "PUT",
"timeout": 0,
"headers": {
"Authorization": localStorage.getItem('accessToken'),
"Content-Type": "application/json"
},
"data": JSON.stringify({
"comment": $('#editCommentReplyContent_'+commentId).val()
}),
};

$.ajax(settings).done(function (response) {
console.log(response);
alert(response)
window.location.reload();
}).fail(function(response){
console.log(response.responseJSON);
if(response.responseJSON.statusCode === 403){
alert(response.responseJSON.message)
window.location.reload();
}
if(response.responseJSON.statusCode === 404){
  alert("다른 유저의 댓글은 수정할 수 없습니다.")
  window.location.reload();
}
});
})
// ---------------------------------------------------------



// -----[해당 버튼 클릭시 대댓글삭제]-----------

$('#t_exePosting').on("click", "button[name='delCommentReply']", function(){
  
      var id_by_name = $(this).attr('id')
      console.log(id_by_name)
      var commentId = id_by_name.split("_")[1]
      console.log(commentId)
      var settings = {
  "url": "http://localhost:8080/t-exercise/comment/"+commentId,
  "method": "DELETE",
  "timeout": 0,
  "headers": {
    "Authorization": localStorage.getItem('accessToken')
  },
};

$.ajax(settings).done(function (response) {
  console.log(response);
  alert(response)
   window.location.reload();

}).fail(function(response){
   console.log(response.responseJSON);
   if(response.responseJSON.statusCode === 403){
    alert(response.responseJSON.message)
   }
});
})
// ------------------------------------------------
  </script>
</body>
</html>
