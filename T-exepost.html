<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="author" content="Untree.co" />
  <link rel="shortcut icon" href="favicon.png" />

  <meta name="description" content="" />
  <meta name="keywords" content="bootstrap, bootstrap5" />

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;500;600;700&display=swap" rel="stylesheet" />

  <link rel="stylesheet" href="fonts/icomoon/style.css" />
  <link rel="stylesheet" href="fonts/flaticon/font/flaticon.css" />

  <link rel="stylesheet" href="css/tiny-slider.css" />
  <link rel="stylesheet" href="css/aos.css" />
  <link rel="stylesheet" href="css/style.css" />

  <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
    crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
    crossorigin="anonymous"></script>
  <script src="js/auth/user/user.js"></script>
  <script src="js/auth/owner/owner.js"></script>
  <script src="js/auth/manager/manager.js"></script>
  <script src="js/auth/kakao/kakao.js"></script>


  <title>
    Property &mdash; Free Bootstrap 5 Website Template by Untree.co
  </title>
</head>

<body>
  <div class="site-mobile-menu site-navbar-target">
    <div class="site-mobile-menu-header">
      <div class="site-mobile-menu-close">
        <span class="icofont-close js-menu-toggle"></span>
      </div>
    </div>
    <div class="site-mobile-menu-body"></div>
  </div>

  <nav class="site-nav">
    <div>
      <ul>
        <a style="color:white"><span id="loginUser"></span></a>
        <a style="color:white" href="login.html"><span id="MainLogin">로그인</span></a>
        <a style="color:white" href="login.html"><span id="MainSignUp">회원가입</span></a>
        <a style="color:white" href="mypage.html"><span id="mypage">마이페이지</span></a>
        <a style="color:white" onclick="logout()" href="index.html"><span id="MainLogout">로그아웃</span></a>
        <a style="color:white" href="admin.html"><span id="adminpage">관리자페이지</span></a>
 
<a style="color:white" href="ownermypage.html"><span id="ownermypage">마이페이지</span></a>
      </ul>
    </div>
    <div class="container">
      <div class="menu-bg-wrap">
        <div class="site-navigation">
          <a href="index.html" class="logo m-0 float-start">SearchingGYM</a>
          <ul class="js-clone-nav d-none d-lg-inline-block text-start site-menu float-end">
            <li class="active"><a href="gym_write_post.html">운동시설등록</a></li>
            <li class="has-children">
              <a href="totalBoard.html">게시판</a>
              <ul class="dropdown">
                <li><a href="FreeBoard.html">자유게시판</a></li>
                <li><a href="T_exe.html">오운완게시판</a></li>
                <li><a href="TodayMeal.html">오먹게시판</a></li>
              </ul>
            </li>
             <li class="has-children">
              <a href=""onClick="alert('작업중입니다')">이벤트게시판</a>
              <ul class="dropdown">
                <li><a href="#"onClick="alert('작업중입니다')">유저이벤트</a></li>
                <li><a href="#"onClick="alert('작업중입니다')">헬스장이벤트</a></li>
                <li><a href="#"onClick="alert('작업중입니다')">사이트이벤트</a></li>
              </ul>
            </li>
            <li class="has-children">
              <a href="contactPageIndex-inquiry.html">고객센터</a>
              <ul class="dropdown">
                <li><a href="contactPageIndex-notice.html">공지사항</a></li>
                <li><a href="contactPageIndex-faq.html">FAQ</a></li>
                <li><a href="contactPageIndex-inquiry.html">1:1문의</a></li>


              </ul>
 </li>
 <li><a href="./gymallshowpost.html">운동시설</a></li>
            </ul>
        <a href="#" class="burger light me-auto float-end mt-1 site-menu-toggle js-menu-toggle d-inline-block d-lg-none"
          data-toggle="collapse" data-target="#main-navbar">
          <span></span>
        </a>
      </div>
    </div>
    </div>
  </nav>

  <div class="hero page-inner overlay" style="background-image: url('images/T_exe.jpg')">
    <div class="container">
      <div class="row justify-content-center align-items-center">
        <div class="col-lg-9 text-center mt-5">
          <h1 class="heading" data-aos="fade-up">오늘 운동 완료!</h1>

          <nav aria-label="breadcrumb" data-aos="fade-up" data-aos-delay="200">
            <ol class="breadcrumb text-center justify-content-center">
              <li class="breadcrumb-item"><a href="index.html">Home</a></li>
              <li class="breadcrumb-item active text-white-50" aria-current="page">
                오.운.완
              </li>
            </ol>
          </nav>
        </div>
      </div>
    </div>
  </div>

  <div id="board_write">
    <h4>오늘의 운동을 기록하는 공간 입니다</h4>
    <div id="write_area">

      <div id="in_title">
        <textarea name="title" id="utitle" rows="1" cols="55" placeholder="제목" maxlength="100" required></textarea>
      </div>

      <div class="wi_line"></div>
      <div id="in_content">
        <textarea name="content" id="ucontent" placeholder="내용" required></textarea>
      </div>

      <input type="file" id="t_exeFile" name="SelectFile" accept="image/*" multiple>


      <div class="bt_se">
        <button type="submit" onclick="t_exePost()">글 작성</button>
      </div>

    </div>
  </div>

  <!-- /.site-footer -->

  <!-- Preloader -->
  <div id="overlayer"></div>
  <div class="loader">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <script src="js/bootstrap.bundle.min.js"></script>
  <script src="js/tiny-slider.js"></script>
  <script src="js/aos.js"></script>
  <script src="js/navbar.js"></script>
  <script src="js/counter.js"></script>
  <script src="js/custom.js"></script>
</body>

<script>
  //--------------------[글등록버튼 누를시 실행]--------------------------------
  function t_exePost() {
    const dtoTitle = $('#utitle').val();

    if (!dtoTitle) {
      return alert("제목을 입력해주세요")
    }
    const dtoContent = $('#ucontent').val();

    if (!dtoContent) {
      return alert("내용을 입력해주세요")
    }

    var presignedUrlg = "이미지.jpa"
    console.log("이미지라고 나와야함 = " + presignedUrlg)

    //--------------------[프리사인url발급요청---]-------------------------
    console.log(document.getElementById("t_exeFile").files.length)

    var fileSize = document.getElementById("t_exeFile").files.length

    var fileNameList = new Array();

    for (let i = 0; i < fileSize; i++) {
      fileNameList.push(document.getElementById("t_exeFile").files[i].name)
    }


    var presigned = {
      "url": "http://ec2-3-36-89-51.ap-northeast-2.compute.amazonaws.com/t-exercise/presigned",
      "method": "POST",
      "timeout": 0,
      "headers": {
        "Authorization": localStorage.getItem('accessToken'),
        "Content-Type": "application/json"
      },
      "data": JSON.stringify({
        "imageName": document.getElementById("t_exeFile").files[0].name
      }),
    };




    console.log("이미지 이름이 나와야함 = " + document.getElementById("t_exeFile").files[0].name)



    $.ajax(presigned).done(function (response) {
      presignedUrlg = response.toString()

      console.log("함수안에서" + presignedUrlg)
      //--------------------[프리사인url발급성공시 S3에 이미지 upload요청--]-------------------------
      var upload = {
        "url": presignedUrlg,
        "method": "PUT",
        "timeout": 0,
        "processData": false,
        "Content-Type": "binary/octet-stream",
        "data": document.getElementById("t_exeFile").files[0]
      };

      $.ajax(upload).done(function (response) {
        console.log(response);
      });

      //--------------------[프리사인url발급성공시 서버에 게시글 upload요청--]-------------------------
      var settings = {
        "url": "http://ec2-3-36-89-51.ap-northeast-2.compute.amazonaws.com/t-exercise",
        "method": "POST",
        "timeout": 0,
        "headers": {
          "Authorization": localStorage.getItem('accessToken'),
          "Content-Type": "application/json"
        },
        "data": JSON.stringify({
          "title": $('#utitle').val(),
          "content": $('#ucontent').val()
        }),
      };

      $.ajax(settings).done(function (response) {
        console.log(response);
        alert(response);
         window.location = './T_exe.html'
      });

    });

    //----------------[프리사인 발급및 게시글 등록 끝]-------------------------
    //-----------------------------------------------------------------
    // var form = new FormData();
    // form.append("file", $("#t_exeFile")[0].files[0]);
    // form.append("file", $("#t_exeFile")[0].files[1]);dw

    // console.log($("#t_exeFile")[0].files[0])
    // console.log($("#t_exeFile")[0].files[1])


    // const json = JSON.stringify({ "title": dtoTitle, "content": dtoContent });

    // const blob = new Blob([json], { type: "application/json" });


    // form.append("BordRequestDTO", blob);

    // var settings = {
    //   "url": "http://ec2-3-36-89-51.ap-northeast-2.compute.amazonaws.com/t-exercise",
    //   "method": "POST",
    //   "timeout": 0,
    //   "processData": false,
    //   "mimeType": "multipart/form-data",
    //   "headers": {
    //     "Authorization": localStorage.getItem('accessToken')
    //   },
    //   "contentType": false,
    //   "data": form
    // };

    // $.ajax(settings).done(function (response) {
    //   console.log(response);
    //   alert(response);
    //   window.location = '/T_exe.html'
    // });

    console.log("함수밖에서" + presignedUrlg)




  }

  document.getElementById("mypage").style.display = "none";
    document.getElementById("MainLogout").style.display = "none";
    document.getElementById("ownermypage").style.display = "none";
    document.getElementById("adminpage").style.display = "none";


</script>

</html>