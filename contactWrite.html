<!DOCTYPE html>
<html lang="en">

<head>
    <script src="https://code.jquery.com/jquery-3.6.0.js"
        integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    <script src="js/auth/user/user.js"></script>
    <script src="js/auth/owner/owner.js"></script>
    <script src="js/auth/manager/manager.js"></script>
    <script src="js/auth/kakao/kakao.js"></script>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="Untree.co" />
    <link rel="shortcut icon" href="favicon.png" />

    <meta name="description" content="" />
    <meta name="keywords" content="bootstrap, bootstrap5" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="crossorigin" />
    <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;500;600;700&display=swap"
        rel="stylesheet" />

    <link rel="stylesheet" href="fonts/icomoon/style.css" />
    <link rel="stylesheet" href="fonts/flaticon/font/flaticon.css" />
    <link rel="stylesheet" href="css/tiny-slider.css" />
    <link rel="stylesheet" href="css/aos.css" />
    <link rel="stylesheet" href="css/style.css" />

    <title>
        운동시설 사이트
    </title>
</head>

<body>
    <div class="site-mobile-menu site-navbar-target">
        <div class="site-mobile-menu-header">
            <div class="site-mobile-menu-close">
                <span class="icofont-close js-menu-toggle"></span>
            </div>
        </div>
        <div class="site-mobile-menu-body"></div>
    </div>

    <nav class="site-nav">
        <div>
            <ul>
                <a style="color:white"><span id="loginUser"></span></a>
                <a style="color:white" href="login.html"><span id="MainLogin">로그인</span></a>
                <a style="color:white" href="login.html"><span id="MainSignUp">회원가입</span></a>
                <a style="color:white" href="mypage.html"><span id="mypage">마이페이지</span></a>
                <a style="color:white" href="admin.html"><span id="adminpage">관리자페이지</span></a>
                <a style="color:white" onclick="logout()" href="index.html"><span id="MainLogout">로그아웃</span></a>
                <a style="color:white" href="FIndByIdAndPw.html"><span id="findbyIdandPw">아이디 및 비밀번호 찾기</span></a>
            </ul>
        </div>
        <div class="container">
            <div class="menu-bg-wrap">
                <div class="site-navigation">
                    <a href="index.html" class="logo m-0 float-start">메인으로</a>

                    <ul class="js-clone-nav d-none d-lg-inline-block text-start site-menu float-end">
                        <li class="active">
                            <a href="index.html">운동시설등록</a>
                        </li>
                        <li class="has-children">
                            <a href="properties.html">게시판</a>
                            <ul class="dropdown">
                                <li>
                                    <a href="#">자유게시판</a>
                                </li>
                                <li>
                                    <a href="#">오운완게시판</a>
                                </li>
                                <li>
                                    <a href="#">오먹게시판</a>
                                </li>
                            </ul>
                        </li>
                        <li class="has-children">
                            <a href="services.html">이벤트게시판</a>
                            <ul class="dropdown">
                                <li>
                                    <a href="#">유저이벤트</a>
                                </li>
                                <li>
                                    <a href="#">헬스장이벤트</a>
                                </li>
                                <li>
                                    <a href="#">사이트이벤트</a>
                                </li>
                            </ul>
                        </li>
                        <li class="has-children">
                            <a href="contactPageIndex-inquiry.html">고객센터</a>
                            <ul class="dropdown">
                                <li>
                                    <a href="contactPageIndex-notice.html">공지사항</a>
                                </li>
                                <li>
                                    <a href="contactPageIndex-faq.html">FAQ</a>
                                </li>
                                <li>
                                    <a href="contactPageIndex-inquiry.html">1:1문의</a>
                                </li>
                            </ul>
                        </li>
                        <li>
                            <a href="contact.html">운동시설</a>
                        </li>
                    </ul>

                    <a href="#"
                        class="burger light me-auto float-end mt-1 site-menu-toggle js-menu-toggle d-inline-block d-lg-none"
                        data-toggle="collapse" data-target="#main-navbar">
                        <span></span>
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <div class="hero page-inner overlay" style="background-image: url('images/hero_bg_1.jpg')">
        <div class="container">
            <div class="row justify-content-center align-items-center">
                <div class="col-lg-9 text-center mt-5">
                    <h1 class="heading" data-aos="fade-up">공지 사항</h1>

                    <nav aria-label="breadcrumb" data-aos="fade-up" data-aos-delay="200">
                        <ol class="breadcrumb text-center justify-content-center">
                            <li class="breadcrumb-item">
                                <a href="index.html">메인</a>
                            </li>
                            <li class="breadcrumb-item">
                                <a href="contactPageIndex-notice.html">
                                    공지사항
                                </a>
                            </li>
                            <li class="breadcrumb-item">
                                <a href="contactPageIndex-faq.html">
                                    FAQ
                                </a>
                            </li>
                            <li class="breadcrumb-item">
                                <a href="contactPageIndex-inquiry.html">
                                    1:1 문의
                                </a>
                            </li>
                        </ol>
                    </nav>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <form action="#">
            <div>
                <label for="exampleFormControlInput1" class="form-label">제목</label>
                <input type="text" class="form-control" id="contactTitle" placeholder="title">
            </div>
            <div>
                <label for="exampleFormControlTextarea1" class="form-label">내용</label>
                <textarea class="form-control" id="contactContent" rows="3"></textarea>
            </div>
            <div>
                <input type="file" id="contact-File" name="SelectFile" accept="image/*" multiple>
            </div>
            <button type="button" class="btn btn-outline-secondary" onclick="contactWrite()">등록하기</button>
            <button type="button" class="btn btn-outline-secondary">
                <a href="contactIndex.html">취소하기</a>
            </button>
    </div>
    </form>

    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/tiny-slider.js"></script>
    <script src="js/aos.js"></script>
    <script src="js/navbar.js"></script>
    <script src="js/counter.js"></script>
    <script src="js/custom.js"></script>
    <script>
        //--------------------[글등록버튼 누를시 실행] --------------------------------
        function contactWrite() {
            var presignedUrlg = "이미지.jpa"
            console.log("이미지라고 나와야함 = " + presignedUrlg)

            //--------------------[프리사인url발급요청---]-------------------------
            var presigned = {
                "url": "http://localhost:8080/api/managers/notices/presigned",
                "method": "POST",
                "timeout": 0,
                "headers": {
                    "Authorization": localStorage.getItem('accessToken'),
                    "Content-Type": "application/json"
                },
                "data": JSON.stringify({
                    "imageName": document.getElementById("contact-File").files[0].name
                }),
            };

            console.log("이미지 이름이 나와야함 = " + document.getElementById("contact-File").files[0].name)

            $.ajax(presigned).done(function (response) {
                presignedUrlg = response.toString()

                console.log("함수안에서" + presignedUrlg)
                //--------------------[프리사인url발급성공시 클라이언트가 S3에 이미지 upload요청--]-------------------------
                var upload = {
                    "url": presignedUrlg,
                    "method": "PUT",
                    "timeout": 0,
                    "processData": false,
                    "Content-Type": "binary/octet-stream",
                    "data": document.getElementById("contact-File").files[0]
                };

                $.ajax(upload).done(function (response) {
                    console.log("s3업로드성공시"+response);
                });

                //--------------------[프리사인url발급성공시 서버에 게시글 upload요청--]-------------------------
                var settings = {
                    "url": "http://localhost:8080/api/managers/notices",
                    "method": "POST",
                    "timeout": 0,
                    "headers": {
                        "Authorization": localStorage.getItem('accessToken'),
                        "Content-Type": "application/json"
                    },
                    "data": JSON.stringify({
                        "title": $('#contactTitle').val(),
                        "content": $('#contactContent').val(),
                    }),
                };

                $.ajax(settings).done(function (response) {
                    console.log(response);
                    alert(response);
                    window.location = './contactPageIndex-notice.html'
                });

            });
            //----------------[프리사인 발급및 게시글 등록 끝]-------------------------
            //-----------------------------------------------------------------

            const dtoTitle = $('#contactTitle').val();

            if (!dtoTitle) {
                return alert("제목을 입력해주세요")
            }
            const dtoContent = $('#contactContent').val();

            if (!dtoContent) {
                return alert("내용을 입력해주세요")
            }
            console.log("함수밖에서" + presignedUrlg)

        }


        document.getElementById("mypage").style.display = "none";
        document.getElementById("MainLogout").style.display = "none";
        document.getElementById("adminpage").style.display = "none";
        if (localStorage.getItem('accessToken') === null) {
            $('#findbyIdandPw').show()
        } else {
            $('#findbyIdandPw').hide()
        }


    </script>

</body>

</html>