<!-- /*
* Template Name: Property
* Template Author: Untree.co
* Template URI: https://untree.co/
* License: https://creativecommons.org/licenses/by/3.0/
*/ -->
<!DOCTYPE html>
<html lang="en">

<head>
  <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
    crossorigin="anonymous"></script>
  <script src="js/auth/user/user.js"></script>
  <script src="js/auth/owner/owner.js"></script>
  <script src="js/auth/manager/manager.js"></script>
  <script src="js/auth/kakao/kakao.js"></script>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="author" content="Untree.co" />
  <link rel="shortcut icon" href="favicon.png" />

  <meta name="description" content="" />
  <meta name="keywords" content="bootstrap, bootstrap5" />

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;500;600;700&display=swap" rel="stylesheet" />

  <link rel="stylesheet" href="fonts/icomoon/style.css" />
  <link rel="stylesheet" href="fonts/flaticon/font/flaticon.css" />

  <link rel="stylesheet" href="css/tiny-slider.css" />
  <link rel="stylesheet" href="css/aos.css" />
  <link rel="stylesheet" href="css/style.css" />
  <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
    crossorigin="anonymous"></script>
  <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css'>


  <title>
    Property &mdash; Free Bootstrap 5 Website Template by Untree.co
  </title>
</head>

<body>
  <div class="site-mobile-menu site-navbar-target">
    <div class="site-mobile-menu-header">
      <div class="site-mobile-menu-close">
        <span class="icofont-close js-menu-toggle"></span>
      </div>
    </div>
    <div class="site-mobile-menu-body"></div>
  </div>

  <nav class="site-nav">
    <div>
      <ul>
        <a style="color:white"><span id="loginUser"></span></a>
        <a style="color:white" href="login.html"><span id="MainLogin">로그인</span></a>
        <a style="color:white" href="login.html"><span id="MainSignUp">회원가입</span></a>
        <a style="color:white" href="mypage.html"><span id="mypage">마이페이지</span></a>
        <a style="color:white" onclick="logout()" href="index.html"><span id="MainLogout">로그아웃</span></a>

      </ul>
    </div>
    <div class="container">
      <div class="menu-bg-wrap">
        <div class="site-navigation">
          <a href="index.html" class="logo m-0 float-start">SearchingGYM</a>
          <ul class="js-clone-nav d-none d-lg-inline-block text-start site-menu float-end">
            <li class="active"><a href="gym_write_post.html">운동시설등록</a></li>
            <li class="has-children">
              <a href="totalBoard.html">게시판</a>
              <ul class="dropdown">
                <li><a href="FreeBoard.html">자유게시판</a></li>
                <li><a href="T_exe.html">오운완게시판</a></li>
                <li><a href="TodayMeal.html">오먹게시판</a></li>
              </ul>
            </li>
            <li class="has-children">
              <a href="services.html">이벤트게시판</a>
              <ul class="dropdown">
                <li><a href="#">유저이벤트</a></li>
                <li><a href="#">헬스장이벤트</a></li>
                <li><a href="#">사이트이벤트</a></li>
              </ul>
            </li>
            <li class="has-children">
              <a href="contactIndex.html">고객센터</a>
              <ul class="dropdown">
                <li><a href="#">공지사항</a></li>
                <li><a href="#">FAQ</a></li>
                <li><a href="contactPageIndex-inquiry.html">1:1문의</a></li>

              </ul>

          </ul>
          <a href="#"
            class="burger light me-auto float-end mt-1 site-menu-toggle js-menu-toggle d-inline-block d-lg-none"
            data-toggle="collapse" data-target="#main-navbar">
            <span></span>
          </a>
        </div>
      </div>
    </div>
  </nav>

  <div class="hero page-inner overlay" style="background-image: url('images/todaymeal.png')">
    <div class="container">
      <div class="row justify-content-center align-items-center">
        <div class="col-lg-9 text-center mt-5">
          <h1 class="heading" data-aos="fade-up">오늘의 식단!</h1>

          <nav aria-label="breadcrumb" data-aos="fade-up" data-aos-delay="200">
            <ol class="breadcrumb text-center justify-content-center">
              <li class="breadcrumb-item"><a href="index.html">Home</a></li>
              <li class="breadcrumb-item active text-white-50" aria-current="page">
                오.먹
              </li>
            </ol>
          </nav>
        </div>
      </div>
    </div>
  </div>

  <div class="section">
    <div class="container">
      <div class="row mb-5 align-items-center">
        <div class="col-lg-6 text-center mx-auto">
          <h2 class="font-weight-bold text-primary heading">
            오늘의 BEST
          </h2>
        </div>
      </div>
      <div class="row">
        <div class="col-12">
          <div class="property-slider-wrap">
            <div class="row" id ="top3">
              
            </div>

      
          </div>
        </div>
      </div>
    </div>
  </div>
  </div>
  </div>
  <div class="section section-properties">
    <div class="container">
      <div class="row" id="t_exePosting">
      </div>
      <div class="row align-items-center py-5">
        <div style="display: flex; margin-bottom: 25px">
          <a href="TodayMealpost.html" class="btn btn-primary py-2 px-3">오먹 등록하기</a>
          <input id="searchInput" type="text" placeholder="제목 + 내용 검색" style="text-align:center;flex:1;border:0;">
          <button class="btn btn-primary py-2 px-3" onclick="searching()">검색</button>
        </div>
        <div class="col-lg-3"></div>
        <div class="col-lg-6 text-center">
          <div class="custom-pagination" id="noticePaging">

          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="site-footer">
    <div class="container">
      <div class="row">
        <div class="col-lg-4">
          <div class="widget">
            <h3>Contact</h3>
            <address>43 Raymouth Rd. Baltemoer, London 3910</address>
            <ul class="list-unstyled links">
              <li><a href="tel://11234567890">+1(123)-456-7890</a></li>
              <li><a href="tel://11234567890">+1(123)-456-7890</a></li>
              <li>
                <a href="mailto:info@mydomain.com">info@mydomain.com</a>
              </li>
            </ul>
          </div>
          <!-- /.widget -->
        </div>
        <!-- /.col-lg-4 -->
        <div class="col-lg-4">
          <div class="widget">
            <h3>Sources</h3>
            <ul class="list-unstyled float-start links">
              <li><a href="#">About us</a></li>
              <li><a href="#">Services</a></li>
              <li><a href="#">Vision</a></li>
              <li><a href="#">Mission</a></li>
              <li><a href="#">Terms</a></li>
              <li><a href="#">Privacy</a></li>
            </ul>
            <ul class="list-unstyled float-start links">
              <li><a href="#">Partners</a></li>
              <li><a href="#">Business</a></li>
              <li><a href="#">Careers</a></li>
              <li><a href="#">Blog</a></li>
              <li><a href="#">FAQ</a></li>
              <li><a href="#">Creative</a></li>
            </ul>
          </div>
          <!-- /.widget -->
        </div>
        <!-- /.col-lg-4 -->
        <div class="col-lg-4">
          <div class="widget">
            <h3>Links</h3>
            <ul class="list-unstyled links">
              <li><a href="#">Our Vision</a></li>
              <li><a href="#">About us</a></li>
              <li><a href="#">Contact us</a></li>
            </ul>

            <ul class="list-unstyled social">
              <li>
                <a href="#"><span class="icon-instagram"></span></a>
              </li>
              <li>
                <a href="#"><span class="icon-twitter"></span></a>
              </li>
              <li>
                <a href="#"><span class="icon-facebook"></span></a>
              </li>
              <li>
                <a href="#"><span class="icon-linkedin"></span></a>
              </li>
              <li>
                <a href="#"><span class="icon-pinterest"></span></a>
              </li>
              <li>
                <a href="#"><span class="icon-dribbble"></span></a>
              </li>
            </ul>
          </div>
          <!-- /.widget -->
        </div>
        <!-- /.col-lg-4 -->
      </div>
      <!-- /.row -->

      <div class="row mt-5">
        <div class="col-12 text-center">
          <!--
          **==========
          NOTE:
          Please don't remove this copyright link unless you buy the license here https://untree.co/license/
          **==========
        -->

          <p>
            Copyright &copy;
            <script>
              document.write(new Date().getFullYear());
            </script>
            . All Rights Reserved. &mdash; Designed with love by
            <a href="https://untree.co">Untree.co</a>
            <!-- License information: https://untree.co/license/ -->
          </p>
          <div>
            Distributed by
            <a href="https://themewagon.com/" target="_blank">themewagon</a>
          </div>


        </div>
      </div>
    </div>
    <!-- /.container -->
  </div>
  <!-- /.site-footer -->

  <!-- Preloader -->
  <div id="overlayer"></div>
  <div class="loader">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <script src="js/bootstrap.bundle.min.js"></script>
  <script src="js/tiny-slider.js"></script>
  <script src="js/aos.js"></script>
  <script src="js/navbar.js"></script>
  <script src="js/counter.js"></script>
  <script src="js/custom.js"></script>
</body>
<script>

  $(document).ready(function () {
    var keywords = localStorage.getItem('searching')
    document.getElementById("mypage").style.display = "none";
    document.getElementById("MainLogout").style.display = "none";

   
    if (localStorage.getItem('accessToken') === null) {
      $('#findbyIdandPw').show()
    } else {
      $('#findbyIdandPw').hide()
    }
  //------------top3------------------
  var top3 = {
  "url": "http://ec2-3-36-89-51.ap-northeast-2.compute.amazonaws.com/todaymeal/top3",
  "method": "GET",
  "timeout": 0,
};

$.ajax(top3).done(function (response) {
  console.log(response);
  let rows = response
      for (let i = 0; i < rows.length; i++) {
        let title = rows[i]['title']
        let modifiedDate = rows[i]['modifiedDate']
        let nickname = rows[i]['userNickname']
        let postid = rows[i]['id']
        let like = rows[i]['like']
        let imageUrl = rows[i]['image']
        console.log(title)

        let temp_html = `<div class="col-xs-12 col-sm-6 col-md-6 col-lg-4">

<div class="property-item mb-30" style="border:3px solid gold;">
  <a id ="urlmap" href="TodayMealpostShow.html?${postid}" class="img">
    <img src="${imageUrl}" alt="Image" class="img-fluid" style="height:350px; width: 415px;" />
  </a>

  <div class="property-content">
    <div class="price mb-2"><span>${title}</span></div>
    <div>
      <span class="d-block mb-2 text-black-50"
        >${modifiedDate}</span
      >
      <span class="city d-block mb-3">${nickname}</span>

      <div class="specs d-flex mb-4">
        <span class="d-block d-flex align-items-center me-3">
          <a class='fa fa-star' style="color:gold" id ="like_${postid}" name="like">  </a>
          <span class="caption" id="update_like_${postid}"style="margin-left: 6px;">    ${like}</span>
        </span>

      </div>

      <a
        href="TodayMealpostShow.html?${postid}"
        class="btn btn-primary py-2 px-3"
        >글 읽기</a
      >
    </div>
  </div>
</div>
</div>`

          $('#top3').append(temp_html)
        }
});
    //---------------------------------------




    if (keywords === null) {
      keywords = ""
    }
    var para = document
      .location
      .href
      .split("?");
    console.log(para[1])

    console.log("키워드값" + keywords)

    var settings = {
      "url": "http://ec2-3-36-89-51.ap-northeast-2.compute.amazonaws.com/todaymeal/allboard?page=" + para[1] + "&search=" + keywords,
      "method": "GET",
      "timeout": 0,
    };

    $.ajax(settings).done(function (response) {
      console.log(response);
      let rows = response.data
      for (let i = 0; i < rows.length; i++) {
        let title = rows[i]['title']
        let modifiedDate = rows[i]['modifiedDate']
        let nickname = rows[i]['userNickname']
        let postid = rows[i]['id']
        let like = rows[i]['like']
        let imageUrl = rows[i]['image']
        console.log(title)

        let temp_html = `<div class="col-xs-12 col-sm-6 col-md-6 col-lg-4">

            <div class="property-item mb-30">
              <a id ="urlmap" href="TodayMealpostShow.html?${postid}" class="img">
                <img src="${imageUrl}" alt="Image" class="img-fluid" style="height:350px; width: 350px;" />
              </a>

              <div class="property-content">
                <div class="price mb-2"><span>${title}</span></div>
                <div>
                  <span class="d-block mb-2 text-black-50"
                    >${modifiedDate}</span
                  >
                  <span class="city d-block mb-3">${nickname}</span>

                  <div class="specs d-flex mb-4">
                    <span class="d-block d-flex align-items-center me-3">
                      <a class='fa fa-heart-o' id ="like_${postid}" name="like">  </a>
                      <span class="caption" id="update_like_${postid}"style="margin-left: 6px;">    ${like}</span>
                    </span>

                  </div>

                  <a
                    href="TodayMealpostShow.html?${postid}"
                    class="btn btn-primary py-2 px-3"
                    >글 읽기</a
                  >
                </div>
              </div>
            </div>
          </div>`

        $('#t_exePosting').append(temp_html)
      }
      let page = response.page
      let totalCount = response.totalCount
      let countPage = response.countPage
      let startPage = ((page - 1) / 10) * 10 + 1;
      let endPage = startPage + countPage - 1;
      let totalPage = response.totalPage;
      if (totalPage < page) {
        page = totalPage;
      }
      if (endPage > totalPage) {
        endPage = totalPage
      }

      var param = document.location.href.split("=");
      console.log(param[1])
      if (page > 1) {
        let temp_html = `<a href="TodayMealMove.html?${page - 1}">pre</a>`
        $('#noticePaging').append(temp_html);
      }

      for (let i = startPage; i <= endPage; i++) {

        let temp_html
        let number = i
        if (page === number) {
          temp_html = `<a href="TodayMealMove.html?${number}"class="active">${number}</a>`
        } else {
          temp_html = `<a href="TodayMealMove.html?${number}" >${number}</a>`
        }
        $('#noticePaging').append(temp_html);
      }
      if (page < totalPage) {
        let temp_html = `<a href="TodayMealMove.html?${page + 1}">next</a>`
        $('#noticePaging').append(temp_html);
      }
    });


  });


  $('#t_exePosting').on("click", "a[name='like']", function () {
    var para = document.location.href.split("?");
    console.log(para[1])

    var id_by_name = $(this).attr('id')

    console.log(id_by_name)
    var postId = id_by_name.split("_")[1]
    console.log(postId)


    var settings = {
      "url": "http://ec2-3-36-89-51.ap-northeast-2.compute.amazonaws.com/todaymeal/" + postId + "/like",
      "method": "POST",
      "timeout": 0,
      "headers": {
        "Authorization": localStorage.getItem('accessToken')
      },
    };

    $.ajax(settings).done(function (response) {
      console.log(response);
      //클릭시 라이크 갯수를 아는게 좋다... 응답으로도 받든가(비추)
      var like = $('#update_like_' + postId).val()
      // $('#update_like_' + postId).empty()
      // $('#update_like_' + postId).append("like : " + like + 1)
      window.location.reload();
    });


  })

  function searching() {

    var keywords = $('#searchInput').val();

    localStorage.setItem('searching', keywords)

    console.log(keywords)
    window.location = './TodayMealMove.html?1'

  }


</script>

</html>